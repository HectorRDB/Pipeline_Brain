---
author: "Hector Roux de Bézieux"
date: '`r format(Sys.time(), "%d %B , %Y")`'
title: "Installing Monocle"
output: pdf_document
---

# Installing Monocle 2
## First Try

No module loaded.
Just open __R__ and do _BiocManager::install("monocle")_.

This fails for packages __densityClust__ and __DDRTree__.

## Second try

First do _module load gcc_ then try again. This works for __densityClust__ but not __DDRTree__.

## Third try 

I realized that this gives the same error as when trying to install _clusterExperiment_. 

```{r, eval = FALSE}
* installing *source* package ‘DDRTree’ ...
** package ‘DDRTree’ successfully unpacked and MD5 sums checked
** libs
icpc -std=gnu++11 -I"/opt/packages/R/3.5.1-mkl/lib64/R/include" 
-DNDEBUG  -I"/pylon5/ib5phhp/diyadas/rpack/3.5/Rcpp/include" 
-I"/pylon5/ib5phhp/hectorrb/rpack/RcppEigen/include" 
-I"/pylon5/ib5phhp/diyadas/rpack/3.5/BH/include" -I/usr/local/include   -fpic  -O3 
-ipo -openmp -xHost -c DDRTree.cpp -o DDRTree.o
icpc: command line error: option '-openmp' is not supported.
Please use the replacement option '-qopenmp'
make: *** [DDRTree.o] Error 1
ERROR: compilation failed for package ‘DDRTree’
* removing ‘/pylon5/ib5phhp/hectorrb/rpack/DDRTree’
```

```{bash, eval = F}
git clone https://github.com/cole-trapnell-lab/DDRTree.git
cp clusterExperiment/src/Makevars DDRTree/src/
R CMD INSTALL DDRTree/
```

That failed. Note that running the block above without line 2 resulted in the same issue.

## Installing all Rcpp dependencies

The issue seems to come from the Rcpp instances in Diya's scratch. So i did
```{bash, eval = FALSE}
[hectorrb@login006 ~]$ module list
Currently Loaded Modulefiles:
  1) psc_path/1.1    2) slurm/default   3) intel/19.3      4) xdusage/2.1-1   5) R/3.5.3-mkl
```

```{r, eval = FALSE}
> install.packages("Rcpp")
> install.packages("RcppEigen")
> install.packages("BH")
> install.packages("DDRTree")
```

This worked!!!

I can then run 

```{r, eval = FALSE}
BiocManager::install("monocle")
```

This fails because of some packages (FNN, densityClust, tidyverse, igraph,...) that Diya installed. Reinstalling those packages worked for all but the "Rtsne" package.

# Installing other packages
## Installing other R packages

Just ssh into bridges, load R and run
```{r, eval = F}
devtools::install_github("cole-trapnell-lab/DDRTree", ref="simple-ppt-like")
devtools::install_github("cole-trapnell-lab/L1-graph")
```
This worked fine.

## Installing 
## Python packages


```{bash, eval = FALSE}
pip install --user virtualenv
```

```{r, eval = FALSE}
install.packages("reticulate")
library(reticulate)
py_install('umap-learn')
```

```{bash, eval = FALSE}
pip install --user louvain
```

Installing Louvain fails.